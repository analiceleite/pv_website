<section class="wrapper">
    <div class="contribution-container">
        <div class="section-header">
            <h2>Contribui√ß√µes e Ofertas</h2>
            <p>Saiba para onde cada recurso est√° indo, vamos juntos edificar o Reino de Deus.</p>
        </div>

        <!-- Header com vers√≠culo inspirador -->
        <div class="verse-banner">
            <div class="verse-content">
                <div class="verse-icon">‚ú®</div>
                <p class="verse-text">"{{ getCurrentVerse().text }}"</p>
                <small class="verse-reference">{{ getCurrentVerse().reference }}</small>
            </div>
        </div>

        <!-- Navega√ß√£o por abas -->
        <div class="tabs-container">
            <button class="tab" [class.active]="activeTab === 'ofertas'" (click)="setActiveTab('ofertas')"
                aria-label="Ofertas R√°pidas">
                <span class="tab-icon">‚ö°</span>
                <span class="tab-text">Ofertas R√°pidas</span>
            </button>
            <button class="tab" [class.active]="activeTab === 'contribuicoes'" (click)="setActiveTab('contribuicoes')"
                aria-label="Tipos de Contribui√ß√£o">
                <span class="tab-icon">‚ù§Ô∏è</span>
                <span class="tab-text">Tipos de Contribui√ß√£o</span>
            </button>
        </div>

        <!-- Conte√∫do das abas -->
        <div class="tab-content">
            <!-- Aba de Ofertas R√°pidas -->
            <div *ngIf="activeTab === 'ofertas'" class="ofertas-tab fade-in">
                <div class="contribution-header">
                    <h2>üíù Oferta R√°pida</h2>
                    <p>Escolha um valor ou digite um valor personalizado</p>
                </div>

                <!-- Valores sugeridos -->
                <div class="amount-grid">
                    <button *ngFor="let amount of suggestedAmounts" class="amount-btn"
                        [class.selected]="selectedAmount === amount" (click)="selectAmount(amount)"
                        [attr.aria-label]="'Selecionar valor de ' + formatCurrency(amount)">
                        <span class="amount-value">{{ formatCurrency(amount) }}</span>
                    </button>
                    <button class="amount-btn custom-btn" [class.selected]="showCustomInput"
                        (click)="showCustomAmountInput()" aria-label="Inserir valor personalizado">
                        <span class="custom-icon">‚úèÔ∏è</span>
                        <span class="custom-text">Outro valor</span>
                    </button>
                </div>

                <!-- Input para valor customizado -->
                <div *ngIf="showCustomInput" class="custom-input-container slide-down">
                    <label for="customAmount" class="input-label">
                        <span class="label-icon">üí∞</span>
                        Digite o valor desejado
                    </label>
                    <div class="input-group">
                        <span class="currency-prefix">R$</span>
                        <input id="customAmount" type="number" min="0.01" step="0.01" [(ngModel)]="customAmount"
                            (blur)="setCustomAmount()" placeholder="0,00" class="custom-amount-input"
                            aria-describedby="amount-help">
                    </div>
                    <small id="amount-help" class="input-help">Valor m√≠nimo: R$ 0,01</small>
                </div>
            </div>

            <!-- Aba de Tipos de Contribui√ß√£o -->
            <div *ngIf="activeTab === 'contribuicoes'" class="contribuicoes-tab fade-in">
                <div class="contribution-header">
                    <h2>üôè Tipos de Contribui√ß√£o</h2>
                    <p>Escolha como deseja contribuir com nossa comunidade</p>
                </div>

                <div class="contribution-options">
                    <div *ngFor="let option of contributionOptions" class="contribution-card" tabindex="0" role="button"
                        [attr.aria-label]="option.title">
                        <div class="card-header">
                            <span class="card-icon">{{ option.icon }}</span>
                            <h4>{{ option.title }}</h4>
                        </div>
                        <p class="description">{{ option.description }}</p>
                        <div *ngIf="option.verse" class="card-verse">
                            <em>"{{ option.verse }}"</em>
                            <small>{{ option.verseRef }}</small>
                        </div>
                    </div>
                </div>

                <!-- Valores sugeridos para contribui√ß√µes -->
                <div class="amount-section">
                    <h4 class="amount-title">
                        <span class="title-icon">üíé</span>
                        Escolha o valor da sua contribui√ß√£o
                    </h4>
                    <div class="amount-grid">
                        <button *ngFor="let amount of suggestedAmounts" class="amount-btn"
                            [class.selected]="selectedAmount === amount" (click)="selectAmount(amount)"
                            [attr.aria-label]="'Selecionar valor de ' + formatCurrency(amount)">
                            <span class="amount-value">{{ formatCurrency(amount) }}</span>
                        </button>
                        <button class="amount-btn custom-btn" [class.selected]="showCustomInput"
                            (click)="showCustomAmountInput()" aria-label="Inserir valor personalizado">
                            <span class="custom-icon">‚úèÔ∏è</span>
                            <span class="custom-text">Outro valor</span>
                        </button>
                    </div>

                    <!-- Input para valor customizado -->
                    <div *ngIf="showCustomInput" class="custom-input-container slide-down">
                        <label for="customAmount2" class="input-label">
                            <span class="label-icon">üí∞</span>
                            Digite o valor desejado
                        </label>
                        <div class="input-group">
                            <span class="currency-prefix">R$</span>
                            <input id="customAmount2" type="number" min="0.01" step="0.01" [(ngModel)]="customAmount"
                                (blur)="setCustomAmount()" placeholder="0,00" class="custom-amount-input"
                                aria-describedby="amount-help2">
                        </div>
                        <small id="amount-help2" class="input-help">Valor m√≠nimo: R$ 0,01</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bot√£o para gerar PIX -->
        <div *ngIf="isValidAmount()" class="generate-pix-section slide-up">
            <!-- Mobile: Copiar chave -->
            <button *ngIf="isMobile" class="generate-pix-btn mobile-btn" (click)="copyPixToClipboard()"
                aria-label="Copiar c√≥digo PIX para pagamento">
                <span class="btn-text">Copiar C√≥digo PIX</span>
                <span class="btn-amount">{{ formatCurrency(selectedAmount || customAmount) }}</span>
            </button>

            <!-- Desktop: Mostrar QR Code -->
            <button *ngIf="!isMobile" class="generate-pix-btn desktop-btn" (click)="generatePixQR()"
                aria-label="Gerar QR Code PIX para pagamento">
                <span class="btn-text">Gerar QR Code PIX</span>
                <span class="btn-amount">{{ formatCurrency(selectedAmount || customAmount) }}</span>
            </button>

            <!-- Mensagem de c√≥pia -->
            <div class="copy-success" *ngIf="showCopyMessage" role="alert">
                <span class="success-icon">‚úÖ</span>
                <span>C√≥digo PIX copiado com sucesso!</span>
            </div>
        </div>

        <!-- Modal do QR Code -->
        <div class="qr-modal" *ngIf="showQRCode" (click)="hidePixQR()" role="dialog" aria-modal="true"
            aria-labelledby="qr-modal-title">
            <div class="qr-modal-content" (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()">
                <div class="qr-header">
                    <h3 id="qr-modal-title">
                        <span class="header-icon">üèõÔ∏è</span>
                        PIX - {{ churchName }}
                    </h3>
                    <button class="close-btn" (click)="hidePixQR()" aria-label="Fechar modal">
                        √ó
                    </button>
                </div>

                <div class="qr-body">
                    <!-- QR Code -->
                    <div class="qr-code-container">
                        <div class="qr-wrapper">
                            <img [src]="qrCodeUrl" width="250" height="250" alt="QR Code PIX para pagamento"
                                class="qr-image" />
                        </div>
                    </div>

                    <div class="qr-info">
                        <div class="amount-display">
                            <span class="amount-label">Valor da contribui√ß√£o</span>
                            <span class="amount-value">{{ formatCurrency(selectedAmount || customAmount) }}</span>
                        </div>

                        <div class="instructions">
                            <h4 class="instructions-title">
                                <span class="instructions-icon">üì±</span>
                                Como pagar com PIX
                            </h4>
                            <ol class="instructions-list">
                                <li>Abra o aplicativo do seu banco</li>
                                <li>Selecione a op√ß√£o PIX</li>
                                <li>Escaneie o c√≥digo QR acima</li>
                                <li>Confirme o pagamento</li>
                            </ol>
                        </div>

                        <!-- C√≥digo PIX -->
                        <div class="pix-code-section">
                            <button class="copy-btn-main" (click)="copyPixKey()" aria-label="Copiar c√≥digo PIX">
                                <span class="copy-icon">üìã</span>
                                <span>Copiar C√≥digo PIX</span>
                            </button>

                            <div class="copy-success" *ngIf="showCopyMessage" role="alert">
                                <span class="success-icon">‚úÖ</span>
                                <span>C√≥digo PIX copiado!</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>